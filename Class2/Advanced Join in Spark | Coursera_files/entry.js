"use strict";define("pages/open-course/programming/entry",["require","exports","module","q","underscore","bundles/discussions/viewModels/viewContext","bundles/ondemand/stores/CourseMembershipStore","bundles/phoenix/lib/exceptions","bundles/phoenix/template/models/userIdentity","bundles/phoenix/utils/openers","js/lib/path","memoize!pages/open-course/common/promises/courseGrade","memoize!pages/open-course/common/promises/itemMetadata","pages/open-course/common/singletons/course","pages/open-course/common/singletons/courseMaterials","pages/open-course/common/singletons/courseProgress","pages/open-course/common/singletons/verificationDisplay","pages/open-course/common/utils/discussionsUrlBuilder","pages/open-course/common/utils/ensureEnrolled","pages/open-course/item/entry","bundles/programming/promises/immediate/assignmentParts","bundles/programming/promises/immediate/instructions","bundles/programming/promises/immediate/submissionHistory","bundles/programming/promises/learnerAssignment","bundles/programming/stores/submissionSummariesStore","lazy!bundles/programming/views/layout","lazy!bundles/programming/views/instructions","lazy!bundles/programming/views/submission","lazy!bundles/discussions/components/DiscussionsBody"],function(require,exports,module){function redirectToInstructionsIfUserRejectedEnroll(e){return function(i){if(i instanceof a.UserRejectedEnrollPromptException){var o=n(s,e);return o.then(function(e){throw new u.Redirect(e.getCourseRelativeLink())})}throw i}}function opener(m,a,u,g){var t=n(s,m),c=t.then(function(s){return"programming"!==s.getTypeName()?o({itemMetadata:s}):e(null)}),p=t.then(function(s){return _(["gradedProgramming","ungradedProgramming"]).contains(s.getTypeName())?w.load({itemMetadata:s,userId:i.get("id"),courseId:s.get("course").get("id"),itemId:s.get("id")}):e(null)}),y=e.all([t,d,M,l,r,c,g,p]).spread(function(e,s,t,n,i,o,r){return h(s.get("id")).then(function(t){return{"bundles/programming/views/layout":{id:"programmingLayout."+e.get("id")+"."+(new Date).getTime(),to:'[data-js="item-container"]',initialize:{subview:a,course:s,courseProgress:n,courseGrade:t,verificationDisplay:i,itemMetadata:e,learnerAssignment:o},regions:{body:r},module:require("lazy!bundles/programming/views/layout")}}})});return b.openItemView(y,m,u)}var e=require("q"),_=require("underscore"),g=require("bundles/discussions/viewModels/viewContext"),t=require("bundles/ondemand/stores/CourseMembershipStore"),u=require("bundles/phoenix/lib/exceptions"),i=require("bundles/phoenix/template/models/userIdentity"),c=require("bundles/phoenix/utils/openers"),z=require("js/lib/path"),h=require("memoize!pages/open-course/common/promises/courseGrade"),n=require("memoize!pages/open-course/common/promises/itemMetadata"),d=require("pages/open-course/common/singletons/course"),M=require("pages/open-course/common/singletons/courseMaterials"),l=require("pages/open-course/common/singletons/courseProgress"),r=require("pages/open-course/common/singletons/verificationDisplay"),p=require("pages/open-course/common/utils/discussionsUrlBuilder"),a=require("pages/open-course/common/utils/ensureEnrolled"),b=require("pages/open-course/item/entry"),y=require("bundles/programming/promises/immediate/assignmentParts"),f=require("bundles/programming/promises/immediate/instructions"),v=require("bundles/programming/promises/immediate/submissionHistory"),o=require("bundles/programming/promises/learnerAssignment"),w=require("bundles/programming/stores/submissionSummariesStore"),m="bundles/programming/views/",s=["gradedProgramming","programming","ungradedProgramming"];exports.instructions=function(t){var a="instructions",u=m+"instructions",i=n(s,t),d=i.then(function(s){return"programming"!==s.getTypeName()?o({itemMetadata:s}):e(null)}),g=i.then(function(e){return"programming"===e.getTypeName()?f({itemMetadata:e,courseId:e.get("course").get("id"),itemId:e.get("id")}):null}),l=i.then(function(e){return"programming"!==e.getTypeName()?o({itemMetadata:e}).then(function(e){return e.submissionLearnerSchema.get("instructions")}):null}),c=e.all([i,g,l,d,r]).spread(function(e,s,n,i,o){return _.object([u],[{id:"instructions",to:'[data-js="body-container"]',initialize:{itemMetadata:e,instructions:n||s,learnerAssignment:i,verificationDisplay:o},module:require("lazy!bundles/programming/views/instructions")}])});return opener(t,"instructions",a,c)},exports.submission=function(u){var d="submission",g=m+"submission",l=n(s,u),c=l.then(function(n){var u=n.getTypeName();if(!_(s).contains(u))throw new Error("Unknown programming assignment type: "+u);var m,a;"programming"===n.getTypeName()?(m=y({itemMetadata:n,userId:i.get("id"),courseId:n.get("course").get("id"),itemId:n.get("id")}),a=v({itemMetadata:n,userId:i.get("id"),courseId:n.get("course").get("id"),itemId:n.get("id")})):(m=e(null),a=e(null));var d;return d="programming"!==n.getTypeName()?o({itemMetadata:n}):e(null),e.all([r,m,a,d,t.deferUntilLoaded()]).spread(function(e,s,o,r){return _.object([g],[{id:"submission",to:'[data-js="body-container"]',initialize:{itemMetadata:n,immediateSubmissionHistory:o,immediateAssignmentParts:s,learnerAssignment:r,verificationDisplay:e,showDebugTools:t.hasTeachingRole()||i.get("is_superuser")},module:require("lazy!bundles/programming/views/submission")}])})});return opener(u,"submission",d,c).then(a).fail(redirectToInstructionsIfUserRejectedEnroll(u))},exports.discussions=function(i,d,e,o,r){var t=p.buildUrl(e,o,r),m="bundles/discussions/components/DiscussionsBody",a=n(s,i),u=a.then(function(s){return _.object([m],[{id:"questions",to:'[data-js="body-container"]',props:{viewContext:new g({itemMetadata:s}),questionId:"object"!=typeof e?e:null},module:require("lazy!bundles/discussions/components/DiscussionsBody")}])});return opener(i,"discussions",t,u)},module.exports=c.validateOpeners(s,exports,"instructions","submission","discussions")});