"use strict";define("bundles/programming/components/GridSubmissionUploadTable",["require","exports","module","classnames","react-with-addons","underscore","bundles/phoenix/components/FileUploader","bundles/phoenix/components/fileUploader/views/uploader","bundles/phoenix/mixins/isHovered","bundles/phoenix/template/models/userIdentity","i18n!nls/programming","pages/open-course/common/constants","css!bundles/programming/components/__styles__/GridSubmissionUploadTable"],function(require,exports,module){var s=require("classnames"),e=require("react-with-addons"),_=require("underscore"),n=require("bundles/phoenix/components/FileUploader"),c=require("bundles/phoenix/components/fileUploader/views/uploader"),a=require("bundles/phoenix/mixins/isHovered"),r=require("bundles/phoenix/template/models/userIdentity"),t=require("i18n!nls/programming"),o=require("pages/open-course/common/constants");require("css!bundles/programming/components/__styles__/GridSubmissionUploadTable");var i=e.createClass({displayName:"PartName",render:function render(){return e.createElement("div",{className:"rc-PartName"},e.createElement("strong",null,this.props.submissionSchemaPart.title))}}),l=e.createClass({displayName:"Activity",render:function render(){var a=this.props,s=a.part,l=a.submissionSchemaPart,p=a.suggestedFilename,n=s.score,d=s.typeName,o=s.uploadedAt,i=s.submittedAt,m=l.maxScore,c="number"==typeof n,u=o&&(!i||o>i),r=null;return"empty"!==d&&(r=u?t("Not Submitted"):c?e.createElement("span",null,n,"/",m):t("Submitted")),e.createElement("div",{className:"rc-Activity"},e.createElement("div",{className:"filename"},s.uploadedFilename||p),r)}}),p=e.createClass({displayName:"Points",render:function render(){var s=this.props.part.score,a=this.props.submissionSchemaPart.maxScore,r="number"==typeof s;if(r)return null;return e.createElement("div",{className:"rc-Points align-right fit-to-content"},a," ",t("points"))}}),d=e.createClass({displayName:"Row",mixins:[a],getInitialState:function getInitialState(){return{createdAt:this.props.part.createdAt,isUploading:!1}},onUploadSelect:function onUploadSelect(){this.props.onUploadSelect&&this.props.onUploadSelect(),this.setState({isUploading:!0})},onUploadSuccess:function onUploadSuccess(s){var e=this.props,t=e.itemMetadata,n=e.partId,o=e.versionId,i=e.viewModel,a=s.uploads[0],l={assemblyId:s.assembly_id,courseId:t.get("course").get("id"),itemMetadata:t,itemId:t.get("id"),learnerId:r.get("id"),partId:n,versionId:o,uploadedFilename:a&&a.name||"unknown"};return i.postUploadPart(l).then(this.onPostUploadPartSuccess,this.onPostUploadPartError)},onUploadError:function onUploadError(e){console.error("upload error:",e),this.props.onUploadError&&this.props.onUploadError(e),this.setState({isUploading:!1})},onPostUploadPartSuccess:function onPostUploadPartSuccess(){this.props.onPostUploadPartSuccess&&this.props.onPostUploadPartSuccess(),this.setState({isUploading:!1})},onPostUploadPartError:function onPostUploadPartError(e){console.error("postUploadPart error:",e),this.setState({isUploading:!1})},renderUploadIndicator:function renderUploadIndicator(){return"empty"!==this.props.part.typeName?e.createElement("span",null,t("Replace file")):e.createElement("i",{className:"cif-upload"})},render:function render(){var t=this.props,d=t.itemMetadata,m=t.inputDisabled,c=t.part,b=t.partId,a=t.submissionSchemaPart,r=t.suggestedFilename,u=this.state,h=u.isHovered,U=u.isUploading,S=h&&!m,f=s("rc-Row",{hovered:h,disabled:U||m}),g=s("upload-indicator",{hover:S});return e.createElement(n,{className:f,templateId:o.upload.transloadit.templates.programming,fields:{phoenix_course_id:d.get("course").get("id"),assignment_id:d.getDefinition("programmingAssignmentId"),part_id:b,file_name:r},hideFormWhileUploading:!1,onUploadSelect:this.onUploadSelect,onUploadSuccess:this.onUploadSuccess,onUploadError:this.onUploadError},e.createElement("div",null,e.createElement("div",{className:"horizontal-box"},e.createElement("div",{className:"flex-1"},e.createElement(i,{submissionSchemaPart:a})),e.createElement("span",{className:g},this.renderUploadIndicator())),e.createElement("div",{className:"horizontal-box"},e.createElement("div",{className:"flex-1"},e.createElement(p,{part:c,submissionSchemaPart:a})),e.createElement(l,{part:c,submissionSchemaPart:a,suggestedFilename:r}))))}}),m=e.createClass({displayName:"GridSubmissionUploadTable",renderTable:function renderTable(){var s=this,a=this.props.filesWorkspace&&_(this.props.filesWorkspace.get("parts")).chain().map(function(t,e){return{id:e,filePart:t,schemaPart:s.props.learnerAssignment.submissionLearnerSchema.get("parts")[e],suggestedFilename:s.props.learnerAssignment.submissionBuilderSchema.getSuggestedFilename(e)}}).sortBy(function(e){return e.schemaPart.order}).value(),r=a&&_(a).some(function(e){return"uploaded"===e.typeName});return a?e.createElement("div",null,r&&e.createElement("div",{className:"unsubmitted-files-alert bt3-alert bt3-alert-warning"},"You have unsubmitted files."),e.createElement("div",null,a.map(function(t){return e.createElement(d,{key:t.id,itemMetadata:s.props.itemMetadata,inputViewModel:s.props.inputViewModel,inputDisabled:s.props.inputDisabled,onUploadSelect:s.props.onUploadSelect,onPostUploadPartSuccess:s.props.onPostUploadPartSuccess,onUploadError:s.props.onUploadError,part:t.filePart,partId:t.id,submissionSchemaPart:t.schemaPart,suggestedFilename:t.suggestedFilename,versionId:s.props.filesWorkspace.get("versionId"),viewModel:s.props.viewModel})}))):e.createElement("div",{className:"loading-area"},e.createElement("span",null,t("Loading"),"..."))},render:function render(){return e.createElement("div",{className:"rc-GridSubmissionUploadTable"},this.renderTable())}});module.exports=m});