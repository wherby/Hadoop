"use strict";define("bundles/programming/components/tokenBox/viewModels/tokenBox",["require","exports","module","underscore","bundles/phoenix/lib/viewModel","bundles/programming/api/immediate/tokens"],function(require,exports,module){var _=require("underscore"),t=require("bundles/phoenix/lib/viewModel"),e=require("bundles/programming/api/immediate/tokens"),n=t.extend({defaults:{state:"empty",secret:null},fsm:{states:["empty","getting","displaying","generating","error"],transitions:{displaying:["getting","generating"],generating:["getting","displaying"],error:["getting","generating"]}},initialize:function initialize(t,e){_(this).bindAll("onGenerateSuccess","onGenerateFailure","onGetSuccess","onGetFailure"),_(this).extend(_(e).pick("itemMetadata"))},_generateToken:function _generateToken(){return this.transition("generating"),e.newToken(this.itemMetadata).then(this.onGenerateSuccess,this.onGenerateFailure)},generateToken:function generateToken(){this._generateToken().done()},getToken:function getToken(){this.transition("getting"),e.get(this.itemMetadata).then(this.onGetSuccess,this.onGetFailure).done()},onGenerateSuccess:function onGenerateSuccess(t){var e=t.body.elements[0];this.transition("displaying",{secret:e.token||e.secret})},onGenerateFailure:function onGenerateFailure(e){throw this.transition("error"),e},onGetSuccess:function onGetSuccess(t){var e=t.elements[0];this.transition("displaying",{secret:e.token||e.secret})},onGetFailure:function onGetFailure(e){if(404===e.status)return this._generateToken();throw this.transition("error"),e}});module.exports=n});